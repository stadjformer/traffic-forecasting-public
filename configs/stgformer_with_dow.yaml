# STGFormer with Temporal Embeddings (Matches External Implementation)
# Uses time-of-day and day-of-week embeddings like the original STGFormer paper.
# DOW is computed on-the-fly from timestamps when loading data.
#
# Usage:
#   python scripts/train_stgformer.py --config configs/stgformer_tod.yaml
#   python scripts/train_stgformer.py --config configs/stgformer_tod.yaml --dataset METR-LA

description: "STGFormer with day-of-week temporal embeddings"

# Datasets to train on (can be overridden with --dataset CLI arg)
# PEMS-BAY first (larger, needs more memory - fail early if OOM)
datasets:
  - PEMS-BAY
  - METR-LA

# Model architecture (matches external STGFormer for METR-LA/PEMS-BAY)
model:
  num_layers: 3
  num_heads: 4
  input_embedding_dim: 24
  tod_embedding_dim: 24  # Enabled - time-of-day embedding from index 1
  dow_embedding_dim: 24  # Enabled - day-of-week embedding from index 2
  adaptive_embedding_dim: 80
  dropout: 0.1
  dropout_a: 0.3
  mlp_ratio: 4
  use_mixed_proj: true

# Graph structure
graph:
  mode: learned  # learned | geographic | hybrid
  sparsity_k: null

# Training
training:
  epochs: 20
  batch_size: 200
  learning_rate: 0.001
  weight_decay: 0.0003
  early_stop: 5
  clip_grad: 0.0
  milestones: [10, 15]
  lr_decay_rate: 0.1
  seed: 42  # Random seed for reproducibility

# Output
output:
  # HF repo: {username}/{hf_repo_prefix}_{dataset} (if username is not specified it gets pulled in from .env_public, dataset always gets appended automatically)
  hf_repo_prefix: STGFORMER_DOW

# Weights & Biases logging (optional)
wandb:
  entity: cs224w-traffic-forecasting
  enabled: true
  # project: traffic-forecasting  # Default
